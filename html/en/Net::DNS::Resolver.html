<html>
<head><meta charset=utf-8/>
<title>Net::DNS::Resolver - DNS resolver class</title></head>
<body><pre>

Net::DNS::Resolver(3pm)User Contributed Perl DocumentatioNet::DNS::Resolver(3pm)



NAME
       Net::DNS::Resolver - DNS resolver class

SYNOPSIS
         use Net::DNS;

         my $res = Net::DNS::Resolver-&gt;new;

         # Perform a lookup, using the searchlist if appropriate.
         my $answer = $res-&gt;search(&apos;example.com&apos;);

         # Perform a lookup, without the searchlist
         my $answer = $res-&gt;query(&apos;example.com&apos;, &apos;MX&apos;);

         # Perform a lookup, without pre or post-processing
         my $answer = $res-&gt;send(&apos;example.com&apos;, &apos;MX&apos;, &apos;CH&apos;);

         # Send a prebuilt packet
         my $packet = Net::DNS::Packet-&gt;new(...);
         my $answer = $res-&gt;send($packet);

DESCRIPTION
       Instances of the &quot;Net::DNS::Resolver&quot; class represent resolver objects.
       A program can have multiple resolver objects, each maintaining its own
       state information such as the nameservers to be queried, whether
       recursion is desired, etc.

METHODS
   new
         # Use the system defaults
         my $res = Net::DNS::Resolver-&gt;new;

         # Use my own configuration file
         my $res = Net::DNS::Resolver-&gt;new(config_file =&gt; &apos;/my/dns.conf&apos;);

         # Set options in the constructor
         my $res = Net::DNS::Resolver-&gt;new(
               nameservers =&gt; [qw(10.1.1.128 10.1.2.128)],
               recurse     =&gt; 0,
               debug       =&gt; 1,
         );

       Returns a resolver object.  If given no arguments, &quot;new()&quot; returns an
       object configured to your system&apos;s defaults.  On UNIX systems the
       defaults are read from the following files, in the order indicated:

           /etc/resolv.conf
           $HOME/.resolv.conf
           ./.resolv.conf

       The following keywords are recognized in resolver configuration files:

       domain
           The default domain.

       search
           A space-separated list of domains to put in the search list.

       nameserver
           A space-separated list of nameservers to query.

       Files except for /etc/resolv.conf must be owned by the effective userid
       running the program or they won&apos;t be read.  In addition, several
       environment variables can also contain configuration information; see
       &quot;ENVIRONMENT&quot;.

       On Windows systems, an attempt is made to determine the system defaults
       using the registry.  This is still a work in progress; systems with many
       dynamically configured network interfaces may confuse Net::DNS.

       You can include a configuration file of your own when creating a resolver
       object:

        # Use my own configuration file
        my $res = Net::DNS::Resolver-&gt;new(config_file =&gt; &apos;/my/dns.conf&apos;);

       This is supported on both UNIX and Windows.  Values pulled from a custom
       configuration file override the the system&apos;s defaults, but can still be
       overridden by the other arguments to new().

       Explicit arguments to new override both the system&apos;s defaults and the
       values of the custom configuration file, if any.  The following arguments
       to new() are supported:

       nameservers
           An array reference of nameservers to query.

       searchlist
           An array reference of domains.

       recurse
       debug
       domain
       port
       srcaddr
       srcport
       tcp_timeout
       udp_timeout
       retrans
       retry
       usevc
       stayopen
       igntc
       defnames
       dnsrch
       persistent_tcp
       persistent_udp
       dnssec

       For more information on any of these options, please consult the method
       of the same name.

   search
           $packet = $res-&gt;search(&apos;mailhost&apos;);
           $packet = $res-&gt;search(&apos;mailhost.example.com&apos;);
           $packet = $res-&gt;search(&apos;192.168.1.1&apos;);
           $packet = $res-&gt;search(&apos;example.com&apos;, &apos;MX&apos;);
           $packet = $res-&gt;search(&apos;user.passwd.example.com&apos;, &apos;TXT&apos;, &apos;HS&apos;);

       Performs a DNS query for the given name, applying the searchlist if
       appropriate.  The search algorithm is as follows:

       1.  If the name contains at least one dot, try it as is.

       2.  If the name doesn&apos;t end in a dot then append each item in the search
           list to the name.  This is only done if dnsrch is true.

       3.  If the name doesn&apos;t contain any dots, try it as is.
&#12;       The record type and class can be omitted; they default to A and IN.  If
       the name looks like an IP address (4 dot-separated numbers), then an
       appropriate PTR query will be performed.

       Returns a &quot;Net::DNS::Packet&quot; object, or &quot;undef&quot; if no answers were found.
       If you need to examine the response packet whether it contains any
       answers or not, use the send() method instead.

   query
           $packet = $res-&gt;query(&apos;mailhost&apos;);
           $packet = $res-&gt;query(&apos;mailhost.example.com&apos;);
           $packet = $res-&gt;query(&apos;192.168.1.1&apos;);
           $packet = $res-&gt;query(&apos;example.com&apos;, &apos;MX&apos;);
           $packet = $res-&gt;query(&apos;user.passwd.example.com&apos;, &apos;TXT&apos;, &apos;HS&apos;);

       Performs a DNS query for the given name; the search list is not applied.
       If the name doesn&apos;t contain any dots and defnames is true then the
       default domain will be appended.

       The record type and class can be omitted; they default to A and IN.  If
       the name looks like an IP address (IPv4 or IPv6), then an appropriate PTR
       query will be performed.

       Returns a &quot;Net::DNS::Packet&quot; object, or &quot;undef&quot; if no answers were found.
       If you need to examine the response packet whether it contains any
       answers or not, use the send() method instead.

   send
           $packet = $res-&gt;send($packet_object);
           $packet = $res-&gt;send(&apos;mailhost.example.com&apos;);
           $packet = $res-&gt;send(&apos;example.com&apos;, &apos;MX&apos;);
           $packet = $res-&gt;send(&apos;user.passwd.example.com&apos;, &apos;TXT&apos;, &apos;HS&apos;);

       Performs a DNS query for the given name.  Neither the searchlist nor the
       default domain will be appended.

       The argument list can be either a &quot;Net::DNS::Packet&quot; object or a list of
       strings.  The record type and class can be omitted; they default to A and
       IN.  If the name looks like an IP address (Ipv4 or IPv6), then an
       appropriate PTR query will be performed.

       Returns a &quot;Net::DNS::Packet&quot; object whether there were any answers or
       not.  Use &quot;$packet-&gt;header-&gt;ancount&quot; or &quot;$packet-&gt;answer&quot; to find out if
       there were any records in the answer section.  Returns &quot;undef&quot; if there
       was an error.

   axfr
           @zone = $res-&gt;axfr;
           @zone = $res-&gt;axfr(&apos;example.com&apos;);
           @zone = $res-&gt;axfr(&apos;passwd.example.com&apos;, &apos;HS&apos;);

       Performs a zone transfer from the first nameserver listed in
       &quot;nameservers&quot;.  If the zone is omitted, it defaults to the first zone
       listed in the resolver&apos;s search list.  If the class is omitted, it
       defaults to IN.

       Returns a list of &quot;Net::DNS::RR&quot; objects, or &quot;undef&quot; if the zone transfer
       failed.

       The redundant SOA record that terminates the zone transfer is not
       returned to the caller.

       See also &quot;axfr_start&quot; and &quot;axfr_next&quot;.

       Here&apos;s an example that uses a timeout:

           $res-&gt;tcp_timeout(10);
           my @zone = $res-&gt;axfr(&apos;example.com&apos;);
&#12;           if (@zone) {
               foreach my $rr (@zone) {
                   $rr-&gt;print;
               }
           } else {
               print &apos;Zone transfer failed: &apos;, $res-&gt;errorstring, &quot;\n&quot;;
           }

   axfr_start
           $res-&gt;axfr_start;
           $res-&gt;axfr_start(&apos;example.com&apos;);
           $res-&gt;axfr_start(&apos;example.com&apos;, &apos;HS&apos;);

       Starts a zone transfer from the first nameserver listed in &quot;nameservers&quot;.
       If the zone is omitted, it defaults to the first zone listed in the
       resolver&apos;s search list.  If the class is omitted, it defaults to IN.

       IMPORTANT:

       This method currently returns the &quot;IO::Socket::INET&quot; object that will be
       used for reading, or &quot;undef&quot; on error.  DO NOT DEPEND ON &quot;axfr_start()&quot;
       returning a socket object.  THIS MIGHT CHANGE in future releases.

       Use &quot;axfr_next&quot; to read the zone records one at a time.

   axfr_next
           $res-&gt;axfr_start(&apos;example.com&apos;);

           while (my $rr = $res-&gt;axfr_next) {
                   $rr-&gt;print;
           }

       Reads records from a zone transfer one at a time.

       Returns &quot;undef&quot; at the end of the zone transfer.  The redundant SOA
       record that terminates the zone transfer is not returned.

       See also &quot;axfr&quot;.

   nameservers
           @nameservers = $res-&gt;nameservers;
           $res-&gt;nameservers(&apos;192.168.1.1&apos;, &apos;192.168.2.2&apos;, &apos;192.168.3.3&apos;);

       Gets or sets the nameservers to be queried.

       Also see the IPv6 transport notes below

   print
           $res-&gt;print;

       Prints the resolver state on the standard output.

   string
           print $res-&gt;string;

       Returns a string representation of the resolver state.

   searchlist
           @searchlist = $res-&gt;searchlist;
           $res-&gt;searchlist(&apos;example.com&apos;, &apos;a.example.com&apos;, &apos;b.example.com&apos;);

       Gets or sets the resolver search list.

   port
           print &apos;sending queries to port &apos;, $res-&gt;port, &quot;\n&quot;;
           $res-&gt;port(9732);

       Gets or sets the port to which we send queries.  This can be useful for
       testing a nameserver running on a non-standard port.  The default is port
       53.

   srcport
           print &apos;sending queries from port &apos;, $res-&gt;srcport, &quot;\n&quot;;
           $res-&gt;srcport(5353);

       Gets or sets the port from which we send queries.  The default is 0,
       meaning any port.

   srcaddr
           print &apos;sending queries from address &apos;, $res-&gt;srcaddr, &quot;\n&quot;;
           $res-&gt;srcaddr(&apos;192.168.1.1&apos;);

       Gets or sets the source address from which we send queries.  Convenient
       for forcing queries out a specific interfaces on a multi-homed host.  The
       default is 0.0.0.0, meaning any local address.

   bgsend
           $socket = $res-&gt;bgsend($packet_object) || die &quot; $res-&gt;errorstring&quot;;

           $socket = $res-&gt;bgsend(&apos;mailhost.example.com&apos;);
           $socket = $res-&gt;bgsend(&apos;example.com&apos;, &apos;MX&apos;);
           $socket = $res-&gt;bgsend(&apos;user.passwd.example.com&apos;, &apos;TXT&apos;, &apos;HS&apos;);

       Performs a background DNS query for the given name, i.e., sends a query
       packet to the first nameserver listed in &quot;$res-&gt;nameservers&quot; and returns
       immediately without waiting for a response.  The program can then perform
       other tasks while waiting for a response from the nameserver.

       The argument list can be either a &quot;Net::DNS::Packet&quot; object or a list of
       strings.  The record type and class can be omitted; they default to A and
       IN.  If the name looks like an IP address (4 dot-separated numbers), then
       an appropriate PTR query will be performed.

       Returns an &quot;IO::Socket::INET&quot; object or &quot;undef&quot; on error in which case
       the reason for failure can be found through a call to the errorstring
       method.

       The program must determine when the socket is ready for reading and call
       &quot;$res-&gt;bgread&quot; to get the response packet.  You can use &quot;$res-&gt;bgisready&quot;
       or &quot;IO::Select&quot; to find out if the socket is ready before reading it.

       bgsend does not support persistent sockets.

   bgread
           $packet = $res-&gt;bgread($socket);
           undef $socket;

       Reads the answer from a background query (see &quot;bgsend&quot;).  The argument is
       an &quot;IO::Socket&quot; object returned by &quot;bgsend&quot;.

       Returns a &quot;Net::DNS::Packet&quot; object or &quot;undef&quot; on error.

       The programmer should close or destroy the socket object after reading
       it.

   bgisready
           $socket = $res-&gt;bgsend(&apos;foo.example.com&apos;);
           until ($res-&gt;bgisready($socket)) {
               # do some other processing
           }
           $packet = $res-&gt;bgread($socket);
           $socket = undef;

       Determines whether a socket is ready for reading.  The argument is an
       &quot;IO::Socket&quot; object returned by &quot;$res-&gt;bgsend&quot;.

       Returns true if the socket is ready, false if not.
&#12;   tsig
           my $tsig = $res-&gt;tsig;

           $res-&gt;tsig(Net::DNS::RR-&gt;new(&quot;$key_name TSIG $key&quot;));

           $tsig = Net::DNS::RR-&gt;new(&quot;$key_name TSIG $key&quot;);
           $tsig-&gt;fudge(60);
           $res-&gt;tsig($tsig);

           $res-&gt;tsig($key_name, $key);

           $res-&gt;tsig(0);

       Get or set the TSIG record used to automatically sign outgoing queries
       and updates.  Call with an argument of 0 or &apos;&apos; to turn off automatic
       signing.

       The default resolver behavior is not to sign any packets.  You must call
       this method to set the key if you&apos;d like the resolver to sign packets
       automatically.

       You can also sign packets manually -- see the &quot;Net::DNS::Packet&quot; and
       &quot;Net::DNS::Update&quot; manual pages for examples.  TSIG records in manually-
       signed packets take precedence over those that the resolver would add
       automatically.

   retrans
           print &apos;retrans interval: &apos;, $res-&gt;retrans, &quot;\n&quot;;
           $res-&gt;retrans(3);

       Get or set the retransmission interval.  The default is 5.

   retry
           print &apos;number of tries: &apos;, $res-&gt;retry, &quot;\n&quot;;
           $res-&gt;retry(2);

       Get or set the number of times to try the query.  The default is 4.

   recurse
           print &apos;recursion flag: &apos;, $res-&gt;recurse, &quot;\n&quot;;
           $res-&gt;recurse(0);

       Get or set the recursion flag.  If this is true, nameservers will be
       requested to perform a recursive query.  The default is true.

   defnames
           print &apos;defnames flag: &apos;, $res-&gt;defnames, &quot;\n&quot;;
           $res-&gt;defnames(0);

       Get or set the defnames flag.  If this is true, calls to query will
       append the default domain to names that contain no dots.  The default is
       true.

   dnsrch
           print &apos;dnsrch flag: &apos;, $res-&gt;dnsrch, &quot;\n&quot;;
           $res-&gt;dnsrch(0);

       Get or set the dnsrch flag.  If this is true, calls to search will apply
       the search list.  The default is true.

   debug
           print &apos;debug flag: &apos;, $res-&gt;debug, &quot;\n&quot;;
           $res-&gt;debug(1);

       Get or set the debug flag.  If set, calls to search, query, and send will
       print debugging information on the standard output.  The default is
       false.

   usevc
           print &apos;usevc flag: &apos;, $res-&gt;usevc, &quot;\n&quot;;
           $res-&gt;usevc(1);
&#12;       Get or set the usevc flag.  If true, then queries will be performed using
       virtual circuits (TCP) instead of datagrams (UDP).  The default is false.

   tcp_timeout
           print &apos;TCP timeout: &apos;, $res-&gt;tcp_timeout, &quot;\n&quot;;
           $res-&gt;tcp_timeout(10);

       Get or set the TCP timeout in seconds.  A timeout of &quot;undef&quot; means
       indefinite.  The default is 120 seconds (2 minutes).

   udp_timeout
           print &apos;UDP timeout: &apos;, $res-&gt;udp_timeout, &quot;\n&quot;;
           $res-&gt;udp_timeout(10);

       Get or set the UDP timeout in seconds.  A timeout of &quot;undef&quot; means the
       retry and retrans settings will be just utilized to perform the retries
       until they are exhausted.  The default is &quot;undef&quot;.

   persistent_tcp
           print &apos;Persistent TCP flag: &apos;, $res-&gt;persistent_tcp, &quot;\n&quot;;
           $res-&gt;persistent_tcp(1);

       Get or set the persistent TCP setting.  If set to true, Net::DNS will
       keep a TCP socket open for each host:port to which it connects.  This is
       useful if you&apos;re using TCP and need to make a lot of queries or updates
       to the same nameserver.

       This option defaults to false unless you&apos;re running under a SOCKSified
       Perl, in which case it defaults to true.

   persistent_udp
           print &apos;Persistent UDP flag: &apos;, $res-&gt;persistent_udp, &quot;\n&quot;;
           $res-&gt;persistent_udp(1);

       Get or set the persistent UDP setting.  If set to true, Net::DNS will
       keep a single UDP socket open for all queries.  This is useful if you&apos;re
       using UDP and need to make a lot of queries or updates.

   igntc
           print &apos;igntc flag: &apos;, $res-&gt;igntc, &quot;\n&quot;;
           $res-&gt;igntc(1);

       Get or set the igntc flag.  If true, truncated packets will be ignored.
       If false, truncated packets will cause the query to be retried using TCP.
       The default is false.

   errorstring
           print &apos;query status: &apos;, $res-&gt;errorstring, &quot;\n&quot;;

       Returns a string containing the status of the most recent query.

   answerfrom
           print &apos;last answer was from: &apos;, $res-&gt;answerfrom, &quot;\n&quot;;

       Returns the IP address from which we received the last answer in response
       to a query.

   answersize
           print &apos;size of last answer: &apos;, $res-&gt;answersize, &quot;\n&quot;;

       Returns the size in bytes of the last answer we received in response to a
       query.

   dnssec
           print &quot;dnssec flag: &quot;, $res-&gt;dnssec, &quot;\n&quot;;
           $res-&gt;dnssec(0);

       Enabled DNSSEC this will set the checking disabled flag in the query
       header and add EDNS0 data as in RFC2671 and RFC3225

       When set to true the answer and additional section of queries from
       secured zones will contain DNSKEY, NSEC and RRSIG records.

       Setting calling the dnssec method with a non-zero value will set the UDP
       packet size to the default value of 2048. If that is to small or to big
       for your environment you should call the udppacketsize() method
       immeditatly after.

          $res-&gt;dnssec(1);    # turns on DNSSEC and sets udp packetsize to 2048
          $res-&gt;udppacketsize(1028);   # lowers the UDP pakcet size

       The method will Croak::croak with the message &quot;You called the
       Net::DNS::Resolver::dnssec() method but do not have Net::DNS::SEC
       installed at ...&quot; if you call it without Net::DNS::SEC being in your @INC
       path.

   cdflag
           print &quot;checking disabled flag: &quot;, $res-&gt;dnssec, &quot;\n&quot;;
           $res-&gt;dnssec(1);
           $res-&gt;cdflag(1);

       Sets or gets the CD bit for a dnssec query.  This bit is always zero for
       non dnssec queries. When the dnssec is enabled the flag defaults to 0 can
       be set to 1.

   adflag
           print &quot;checking disabled flag: &quot;, $res-&gt;dnssec, &quot;\n&quot;;
           $res-&gt;dnssec(1);
           $res-&gt;adflag(1);

       Sets or gets the AD bit for a dnssec query.  This bit is always zero for
       non dnssec queries. When the dnssec is enabled the flag defaults to 1.

   udppacketsize
           print &quot;udppacketsize: &quot;, $res-&gt;udppacketsize, &quot;\n&quot;;
           $res-&gt;udppacketsize(2048);

       udppacketsize will set or get the packet size. If set to a value greater
       than Net::DNS::PACKETSZ() an EDNS extension will be added indicating
       support for MTU path recovery.

       Default udppacketsize is Net::DNS::PACKETSZ() (512)

CUSTOMIZING
       Net::DNS::Resolver is actually an empty subclass.  At compile time a
       super class is chosen based on the current platform.  A side benefit of
       this allows for easy modification of the methods in Net::DNS::Resolver.
       You simply add a method to the namespace!

       For example, if we wanted to cache lookups:

        package Net::DNS::Resolver;

        my %cache;

        sub search {
               my ($self, @args) = @_;

               return $cache{@args} ||= $self-&gt;SUPER::search(@args);
        }

IPv6 transport
       The Net::DNS::Resolver library will use IPv6 transport if the appropriate
       libraries (Socket6 and IO::Socket::INET6) are available and the address
       the server tries to connect to is an IPv6 address.

       The print() will method will report if IPv6 transport is available.

       You can use the force_v4() method with a non-zero argument to force IPv4
       transport.

       The nameserver() method has IPv6 dependend behavior. If IPv6 is not
       available or IPv4 transport has been forced the nameserver() method will
       only return IPv4 addresses.

       For example

           $res-&gt;nameservers(&apos;192.168.1.1&apos;, &apos;192.168.2.2&apos;, &apos;2001:610:240:0:53:0:0:3&apos;);
           $res-&gt;force_v4(1);
           print join (&quot; &quot;,$res-&gt;nameserver());

       Will print: 192.168.1.1 192.168.2.2

ENVIRONMENT
       The following environment variables can also be used to configure the
       resolver:

   RES_NAMESERVERS
           # Bourne Shell
           RES_NAMESERVERS=&quot;192.168.1.1 192.168.2.2 192.168.3.3&quot;
           export RES_NAMESERVERS

           # C Shell
           setenv RES_NAMESERVERS &quot;192.168.1.1 192.168.2.2 192.168.3.3&quot;

       A space-separated list of nameservers to query.

   RES_SEARCHLIST
           # Bourne Shell
           RES_SEARCHLIST=&quot;example.com sub1.example.com sub2.example.com&quot;
           export RES_SEARCHLIST

           # C Shell
           setenv RES_SEARCHLIST &quot;example.com sub1.example.com sub2.example.com&quot;

       A space-separated list of domains to put in the search list.

   LOCALDOMAIN
           # Bourne Shell
           LOCALDOMAIN=example.com
           export LOCALDOMAIN

           # C Shell
           setenv LOCALDOMAIN example.com

       The default domain.

   RES_OPTIONS
           # Bourne Shell
           RES_OPTIONS=&quot;retrans:3 retry:2 debug&quot;
           export RES_OPTIONS

           # C Shell
           setenv RES_OPTIONS &quot;retrans:3 retry:2 debug&quot;

       A space-separated list of resolver options to set.  Options that take
       values are specified as option:value.

BUGS
       Error reporting and handling needs to be improved.

       The current implementation supports TSIG only on outgoing packets.  No
       validation of server replies is performed.

       bgsend does not honor the usevc flag and only uses UDP for transport.

COPYRIGHT
       Copyright (c) 1997-2002 Michael Fuhr.

       Portions Copyright (c) 2002-2004 Chris Reinhardt.  Portions Copyright (c)
       2005 Olaf M. Kolkman, NLnet Labs.

       All rights reserved.  This program is free software; you may redistribute
       it and/or modify it under the same terms as Perl itself.

SEE ALSO
       perl(1), Net::DNS, Net::DNS::Packet, Net::DNS::Update, Net::DNS::Header,
       Net::DNS::Question, Net::DNS::RR, resolver(5), RFC 1035, RFC 1034 Section
       4.3.5



perl v5.14.2                       2011-11-15            Net::DNS::Resolver(3pm)

</pre></body></html>
