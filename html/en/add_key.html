<html>
<head><meta charset=utf-8/>
<title>add_key - add a key to the kernel's key management facility</title></head>
<body><pre>

ADD_KEY(2)                 Linux Key Management Calls                 ADD_KEY(2)



NAME
       add_key - add a key to the kernel&apos;s key management facility

SYNOPSIS
       #include &lt;keyutils.h&gt;

       key_serial_t add_key(const char *type, const char *description,
                            const void *payload, size_t plen,
                            key_serial_t keyring);

DESCRIPTION
       add_key() asks the kernel to create or update a key of the given type and
       description, instantiate it with the  payload  of  length  plen,  and  to
       attach it to the nominated keyring and to return its serial number.

       The  key  type may reject the data if it&apos;s in the wrong format or in some
       other way invalid.

       If the destination keyring already contains a key that matches the speci&#8208;
       fied  type  and  description  then, if the key type supports it, that key
       will be updated rather than a new key being created; if not,  a  new  key
       will  be created and it will displace the link to the extant key from the
       keyring.

       The destination keyring serial number may be that of a valid  keyring  to
       which the caller has write permission, or it may be a special keyring ID:

       KEY_SPEC_THREAD_KEYRING
              This specifies the caller&apos;s thread-specific keyring.

       KEY_SPEC_PROCESS_KEYRING
              This specifies the caller&apos;s process-specific keyring.

       KEY_SPEC_SESSION_KEYRING
              This specifies the caller&apos;s session-specific keyring.

       KEY_SPEC_USER_KEYRING
              This specifies the caller&apos;s UID-specific keyring.

       KEY_SPEC_USER_SESSION_KEYRING
              This specifies the caller&apos;s UID-session keyring.

KEY TYPES
       There  are  a  number  of  key types available in the core key management
       code, and these can be specified to this function:

       &#8220;user&#8221; Keys of the user-defined key type may contain a blob of  arbitrary
              data,  and  the  description may be any valid string, though it is
              preferred that the description be prefixed with  a  string  repre&#8208;
              senting  the  service  to which the key is of interest and a colon
              (for instance &#8220;afs:mykey&#8221;).  The payload may be empty or NULL  for
              keys of this type.

       &#8220;keyring&#8221;
              Keyrings are special key types that may contain links to sequences
              of other keys of any type.  If this interface is used to create  a
              keyring,  then a NULL payload should be specified, and plen should
              be zero.

RETURN VALUE
       On success add_key() returns the serial number of the key it  created  or
       updated.   On  error,  the  value -1 will be returned and errno will have
       been set to an appropriate error.

ERRORS
       ENOKEY The keyring doesn&apos;t exist.

       EKEYEXPIRED
              The keyring has expired.

       EKEYREVOKED
              The keyring has been revoked.

       EINVAL The payload data was invalid.

       ENOMEM Insufficient memory to create a key.

       EDQUOT The key quota for this user would be exceeded by creating this key
              or linking it to the keyring.

       EACCES The keyring wasn&apos;t available for modification by the user.

LINKING
       Although  this  is a Linux system call, it is not present in libc but can
       be found rather in libkeyutils.  When linking, -lkeyutils should be spec&#8208;
       ified to the linker.

SEE ALSO
       keyctl(1), keyctl(2), request_key(2)

COLOPHON
       This  page  is  part  of  release 3.44 of the Linux man-pages project.  A
       description of the project, and information about reporting bugs, can  be
       found at http://www.kernel.org/doc/man-pages/.



Linux                              2010-02-25                         ADD_KEY(2)

</pre></body></html>
