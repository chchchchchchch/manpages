<html>
<head><meta charset=utf-8/>
<title>pthread_attr_init, pthread_attr_destroy - initialize and destroy thread attributes object</title></head>
<body><pre>

PTHREAD_ATTR_INIT(3)        Linux Programmer&apos;s Manual       PTHREAD_ATTR_INIT(3)



NAME
       pthread_attr_init,  pthread_attr_destroy  - initialize and destroy thread
       attributes object

SYNOPSIS
       #include &lt;pthread.h&gt;

       int pthread_attr_init(pthread_attr_t *attr);
       int pthread_attr_destroy(pthread_attr_t *attr);

       Compile and link with -pthread.

DESCRIPTION
       The pthread_attr_init() function initializes the thread attributes object
       pointed to by attr with default attribute values.  After this call, indi&#8208;
       vidual attributes of the object can be set using  various  related  func&#8208;
       tions  (listed under SEE ALSO), and then the object can be used in one or
       more pthread_create(3) calls that create threads.

       Calling pthread_attr_init()  on  a  thread  attributes  object  that  has
       already been initialized results in undefined behavior.

       When  a  thread  attributes  object  is  no longer required, it should be
       destroyed using the pthread_attr_destroy() function.  Destroying a thread
       attributes  object  has no effect on threads that were created using that
       object.

       Once a thread attributes object has been destroyed, it can be  reinitial&#8208;
       ized  using  pthread_attr_init().   Any  other  use of a destroyed thread
       attributes object has undefined results.

RETURN VALUE
       On success, these functions return 0; on error,  they  return  a  nonzero
       error number.

ERRORS
       POSIX.1-2001  documents an ENOMEM error for pthread_attr_init(); on Linux
       these functions always succeed (but portable  and  future-proof  applica&#8208;
       tions should nevertheless handle a possible error return).

CONFORMING TO
       POSIX.1-2001.

NOTES
       The  pthread_attr_t  type  should be treated as opaque: any access to the
       object other than via pthreads  functions  is  nonportable  and  produces
       undefined results.

EXAMPLE
       The program below optionally makes use of pthread_attr_init() and various
       related functions to initialize a thread attributes object that  is  used
       to   create   a  single  thread.   Once  created,  the  thread  uses  the
       pthread_getattr_np(3) function (a nonstandard GNU extension) to  retrieve
       the thread&apos;s attributes, and then displays those attributes.

       If  the program is run with no command-line argument, then it passes NULL
       as the attr argument of pthread_create(3), so that the thread is  created
       with  default  attributes.   Running the program on Linux/x86-32 with the
       NPTL threading implementation, we see the following:

           $ ulimit -s       # No stack imit ==&gt; default stack size is 2MB
           unlimited
           $ ./a.out
           Thread attributes:
                   Detach state        = PTHREAD_CREATE_JOINABLE
                   Scope               = PTHREAD_SCOPE_SYSTEM
                   Inherit scheduler   = PTHREAD_INHERIT_SCHED
                   Scheduling policy   = SCHED_OTHER
                   Scheduling priority = 0
                   Guard size          = 4096 bytes
                   Stack address       = 0x40196000
                   Stack size          = 0x201000 bytes

       When we supply a stack size as a command-line argument, the program  ini&#8208;
       tializes  a  thread  attributes  object,  sets various attributes in that
       object, and passes a pointer to the object in the  call  to  pthread_cre&#8208;
       ate(3).   Running  the  program  on  Linux/x86-32 with the NPTL threading
       implementation, we see the following:

           $ ./a.out 0x3000000
           posix_memalign() allocated at 0x40197000
           Thread attributes:
                   Detach state        = PTHREAD_CREATE_DETACHED
                   Scope               = PTHREAD_SCOPE_SYSTEM
                   Inherit scheduler   = PTHREAD_EXPLICIT_SCHED
                   Scheduling policy   = SCHED_OTHER
                   Scheduling priority = 0
                   Guard size          = 0 bytes
                   Stack address       = 0x40197000
                   Stack size          = 0x3000000 bytes

   Program source

       #define _GNU_SOURCE     /* To get pthread_getattr_np() declaration */
       #include &lt;pthread.h&gt;
       #include &lt;stdio.h&gt;
       #include &lt;stdlib.h&gt;
       #include &lt;unistd.h&gt;
       #include &lt;errno.h&gt;

       #define handle_error_en(en, msg) \
               do { errno = en; perror(msg); exit(EXIT_FAILURE); } while (0)

       static void
       display_pthread_attr(pthread_attr_t *attr, char *prefix)
       {
           int s, i;
           size_t v;
           void *stkaddr;
           struct sched_param sp;

           s = pthread_attr_getdetachstate(attr, &amp;i);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getdetachstate&quot;);
           printf(&quot;%sDetach state        = %s\n&quot;, prefix,
                   (i == PTHREAD_CREATE_DETACHED) ? &quot;PTHREAD_CREATE_DETACHED&quot; :
                   (i == PTHREAD_CREATE_JOINABLE) ? &quot;PTHREAD_CREATE_JOINABLE&quot; :
                   &quot;???&quot;);

           s = pthread_attr_getscope(attr, &amp;i);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getscope&quot;);
           printf(&quot;%sScope               = %s\n&quot;, prefix,
                   (i == PTHREAD_SCOPE_SYSTEM)  ? &quot;PTHREAD_SCOPE_SYSTEM&quot; :
                   (i == PTHREAD_SCOPE_PROCESS) ? &quot;PTHREAD_SCOPE_PROCESS&quot; :
                   &quot;???&quot;);

           s = pthread_attr_getinheritsched(attr, &amp;i);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getinheritsched&quot;);
           printf(&quot;%sInherit scheduler   = %s\n&quot;, prefix,
                   (i == PTHREAD_INHERIT_SCHED)  ? &quot;PTHREAD_INHERIT_SCHED&quot; :
                   (i == PTHREAD_EXPLICIT_SCHED) ? &quot;PTHREAD_EXPLICIT_SCHED&quot; :
                   &quot;???&quot;);

           s = pthread_attr_getschedpolicy(attr, &amp;i);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getschedpolicy&quot;);
           printf(&quot;%sScheduling policy   = %s\n&quot;, prefix,
                   (i == SCHED_OTHER) ? &quot;SCHED_OTHER&quot; :
                   (i == SCHED_FIFO)  ? &quot;SCHED_FIFO&quot; :
                   (i == SCHED_RR)    ? &quot;SCHED_RR&quot; :
                   &quot;???&quot;);

           s = pthread_attr_getschedparam(attr, &amp;sp);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getschedparam&quot;);
           printf(&quot;%sScheduling priority = %d\n&quot;, prefix, sp.sched_priority);

           s = pthread_attr_getguardsize(attr, &amp;v);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getguardsize&quot;);
           printf(&quot;%sGuard size          = %d bytes\n&quot;, prefix, v);

           s = pthread_attr_getstack(attr, &amp;stkaddr, &amp;v);
           if (s != 0)
               handle_error_en(s, &quot;pthread_attr_getstack&quot;);
           printf(&quot;%sStack address       = %p\n&quot;, prefix, stkaddr);
           printf(&quot;%sStack size          = 0x%x bytes\n&quot;, prefix, v);
       }

       static void *
       thread_start(void *arg)
       {
           int s;
           pthread_attr_t gattr;

           /* pthread_getattr_np() is a non-standard GNU extension that
              retrieves the attributes of the thread specified in its
              first argument */

           s = pthread_getattr_np(pthread_self(), &amp;gattr);
           if (s != 0)
               handle_error_en(s, &quot;pthread_getattr_np&quot;);

           printf(&quot;Thread attributes:\n&quot;);
           display_pthread_attr(&amp;gattr, &quot;\t&quot;);

           exit(EXIT_SUCCESS);         /* Terminate all threads */
       }

       int
       main(int argc, char *argv[])
       {
           pthread_t thr;
           pthread_attr_t attr;
           pthread_attr_t *attrp;      /* NULL or &amp;attr */
           int s;

           attrp = NULL;

           /* If a command-line argument was supplied, use it to set the
              stack-size attribute and set a few other thread attributes,
              and set attrp pointing to thread attributes object */

           if (argc &gt; 1) {
               int stack_size;
               void *sp;

               attrp = &amp;attr;

               s = pthread_attr_init(&amp;attr);
               if (s != 0)
                   handle_error_en(s, &quot;pthread_attr_init&quot;);

               s = pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
               if (s != 0)
                   handle_error_en(s, &quot;pthread_attr_setdetachstate&quot;);

               s = pthread_attr_setinheritsched(&amp;attr, PTHREAD_EXPLICIT_SCHED);
               if (s != 0)
                   handle_error_en(s, &quot;pthread_attr_setinheritsched&quot;);

               stack_size = strtoul(argv[1], NULL, 0);

               s = posix_memalign(&amp;sp, sysconf(_SC_PAGESIZE), stack_size);
               if (s != 0)
                   handle_error_en(s, &quot;posix_memalign&quot;);

               printf(&quot;posix_memalign() allocated at %p\n&quot;, sp);

               s = pthread_attr_setstack(&amp;attr, sp, stack_size);
               if (s != 0)
                   handle_error_en(s, &quot;pthread_attr_setstack&quot;);
           }

           s = pthread_create(&amp;thr, attrp, &amp;thread_start, NULL);
           if (s != 0)
               handle_error_en(s, &quot;pthread_create&quot;);

           if (attrp != NULL) {
               s = pthread_attr_destroy(attrp);
               if (s != 0)
                   handle_error_en(s, &quot;pthread_attr_destroy&quot;);
           }

           pause();    /* Terminates when other thread calls exit() */
       }

SEE ALSO
       pthread_attr_setaffinity_np(3), pthread_attr_setdetachstate(3),
       pthread_attr_setguardsize(3), pthread_attr_setinheritsched(3),
       pthread_attr_setschedparam(3), pthread_attr_setschedpolicy(3),
       pthread_attr_setscope(3), pthread_attr_setstack(3),
       pthread_attr_setstackaddr(3), pthread_attr_setstacksize(3),
       pthread_create(3), pthread_getattr_np(3), pthreads(7)

COLOPHON
       This page is part of release 3.44 of the Linux man-pages project.  A
       description of the project, and information about reporting bugs, can be
       found at http://www.kernel.org/doc/man-pages/.



Linux                              2008-11-11               PTHREAD_ATTR_INIT(3)

</pre></body></html>
