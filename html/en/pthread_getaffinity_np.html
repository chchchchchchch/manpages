<html>
<head><meta charset=utf-8/>
<title>pthread_setaffinity_np, pthread_getaffinity_np - set/get CPU affinity of a thread</title></head>
<body><pre>

PTHREAD_SETAFFINITY_NP(3)   Linux Programmer&apos;s Manual  PTHREAD_SETAFFINITY_NP(3)



NAME
       pthread_setaffinity_np,  pthread_getaffinity_np - set/get CPU affinity of
       a thread

SYNOPSIS
       #define _GNU_SOURCE             /* See feature_test_macros(7) */
       #include &lt;pthread.h&gt;

       int pthread_setaffinity_np(pthread_t thread, size_t cpusetsize,
                                  const cpu_set_t *cpuset);
       int pthread_getaffinity_np(pthread_t thread, size_t cpusetsize,
                                  cpu_set_t *cpuset);

       Compile and link with -pthread.

DESCRIPTION
       The pthread_setaffinity_np() function sets the CPU affinity mask  of  the
       thread  thread  to the CPU set pointed to by cpuset.  If the call is suc&#8208;
       cessful, and the thread is not currently running on one of  the  CPUs  in
       cpuset, then it is migrated to one of those CPUs.

       The  pthread_getaffinity_np()  function  returns the CPU affinity mask of
       the thread thread in the buffer pointed to by cpuset.

       For more details on CPU affinity masks, see sched_setaffinity(2).  For  a
       description of a set of macros that can be used to manipulate and inspect
       CPU sets, see CPU_SET(3).

       The argument cpusetsize is the length (in bytes) of the buffer pointed to
       by   cpuset.    Typically,   this   argument   would   be   specified  as
       sizeof(cpu_set_t).  (It may be some other  value,  if  using  the  macros
       described in CPU_SET(3) for dynamically allocating a CPU set.)

RETURN VALUE
       On  success,  these  functions  return 0; on error, they return a nonzero
       error number.

ERRORS
       EFAULT A supplied memory address was invalid.

       EINVAL (pthread_setaffinity_np()) The affinity bit mask mask contains  no
              processors that are currently physically on the system and permit&#8208;
              ted to the thread  according  to  any  restrictions  that  may  be
              imposed by the &quot;cpuset&quot; mechanism described in cpuset(7).

       EINVAL (pthread_setaffinity_np()) cpuset specified a CPU that was outside
              the set supported by the kernel.  (The kernel configuration option
              CONFIG_NR_CPUS  defines the range of the set supported by the ker&#8208;
              nel data type used to represent CPU sets.)

       EINVAL (pthread_getaffinity_np()) cpusetsize is smaller than the size  of
              the affinity mask used by the kernel.

       ESRCH  No thread with the ID thread could be found.

VERSIONS
       These functions are provided by glibc since version 2.3.4.

CONFORMING TO
       These  functions  are  nonstandard GNU extensions; hence the suffix &quot;_np&quot;
       (nonportable) in the names.
&#12;NOTES
       After a call to pthread_setaffinity_np(), the set of CPUs  on  which  the
       thread  will actually run is the intersection of the set specified in the
       cpuset argument and the set of CPUs actually present on the system.   The
       system  may  further restrict the set of CPUs on which the thread runs if
       the &quot;cpuset&quot; mechanism described  in  cpuset(7)  is  being  used.   These
       restrictions  on  the actual set of CPUs on which the thread will run are
       silently imposed by the kernel.

       These functions are implemented on top of  the  sched_setaffinity(2)  and
       sched_getaffinity(2) system calls.

       In  glibc  2.3.3 only, versions of these functions were provided that did
       not have a cpusetsize argument.  Instead the CPU set size  given  to  the
       underlying system calls was always sizeof(cpu_set_t).

       A  new  thread  created  by pthread_create(3) inherits a copy of its cre&#8208;
       ator&apos;s CPU affinity mask.

EXAMPLE
       In the following program, the main thread  uses  pthread_setaffinity_np()
       to set its CPU affinity mask to include CPUs 0 to 7 (which may not all be
       available on the system),  and  then  calls  pthread_getaffinity_np()  to
       check the resulting CPU affinity mask of the thread.

       #define _GNU_SOURCE
       #include &lt;pthread.h&gt;
       #include &lt;stdio.h&gt;
       #include &lt;stdlib.h&gt;
       #include &lt;errno.h&gt;

       #define handle_error_en(en, msg) \
               do { errno = en; perror(msg); exit(EXIT_FAILURE); } while (0)

       int
       main(int argc, char *argv[])
       {
           int s, j;
           cpu_set_t cpuset;
           pthread_t thread;

           thread = pthread_self();

           /* Set affinity mask to include CPUs 0 to 7 */

           CPU_ZERO(&amp;cpuset);
           for (j = 0; j &lt; 8; j++)
               CPU_SET(j, &amp;cpuset);

           s = pthread_setaffinity_np(thread, sizeof(cpu_set_t), &amp;cpuset);
           if (s != 0)
               handle_error_en(s, &quot;pthread_setaffinity_np&quot;);

           /* Check the actual affinity mask assigned to the thread */

           s = pthread_getaffinity_np(thread, sizeof(cpu_set_t), &amp;cpuset);
           if (s != 0)
               handle_error_en(s, &quot;pthread_getaffinity_np&quot;);

           printf(&quot;Set returned by pthread_getaffinity_np() contained:\n&quot;);
           for (j = 0; j &lt; CPU_SETSIZE; j++)
               if (CPU_ISSET(j, &amp;cpuset))
                   printf(&quot;    CPU %d\n&quot;, j);

           exit(EXIT_SUCCESS);
       }

SEE ALSO
       sched_setaffinity(2),    sched_setscheduler(2),    pthread_attr_setaffin&#8208;
       ity_np(3), pthread_self(3), sched_getcpu(3), cpuset(7), pthreads(7)

COLOPHON
       This page is part of release 3.44 of  the  Linux  man-pages  project.   A
       description  of the project, and information about reporting bugs, can be
       found at http://www.kernel.org/doc/man-pages/.



Linux                              2010-09-10          PTHREAD_SETAFFINITY_NP(3)

</pre></body></html>
