<html>
<head><meta charset=utf-8/>
<title>rtime - get time from a remote machine</title></head>
<body><pre>

RTIME(3)                    Linux Programmer&apos;s Manual                   RTIME(3)



NAME
       rtime - get time from a remote machine

SYNOPSIS
       #include &lt;rpc/des_crypt.h&gt;

       int rtime(struct sockaddr_in *addrp, struct rpc_timeval *timep,
                 struct rpc_timeval *timeout);

DESCRIPTION
       This  function  uses  the Time Server Protocol as described in RFC 868 to
       obtain the time from a remote machine.

       The Time Server Protocol gives the time in seconds since 00:00:00 UTC,  1
       Jan  1900,  and this function subtracts the appropriate constant in order
       to convert the result to seconds since  the  Epoch,  1970-01-01  00:00:00
       +0000 (UTC).

       When  timeout is non-NULL, the udp/time socket (port 37) is used.  Other&#8208;
       wise, the tcp/time socket (port 37) is used.

RETURN VALUE
       On success, 0 is returned, and the obtained 32-bit time value  is  stored
       in  timep-&gt;tv_sec.   In  case  of  error -1 is returned, and errno is set
       appropriately.

ERRORS
       All errors for underlying  functions  (sendto(2),  poll(2),  recvfrom(2),
       connect(2), read(2)) can occur.  Moreover:

       EIO    The number of returned bytes is not 4.

       ETIMEDOUT
              The waiting time as defined in timeout has expired.

NOTES
       Only IPv4 is supported.

       Some  in.timed  versions  only support TCP.  Try the example program with
       use_tcp set to 1.

       Libc5 uses the prototype
       int rtime(struct sockaddr_in *, struct timeval *, struct timeval *);
       and requires &lt;sys/time.h&gt; instead of &lt;rpc/auth_des.h&gt;.

BUGS
       rtime() in glibc 2.2.5 and earlier  does  not  work  properly  on  64-bit
       machines.

EXAMPLE
       This  example  requires  that port 37 is up and open.  You may check that
       the time entry within /etc/inetd.conf is not commented out.
       The program connects to a computer  called  &quot;linux&quot;.   Using  &quot;localhost&quot;
       does not work.  The result is the localtime of the computer &quot;linux&quot;.

       #include &lt;stdio.h&gt;
       #include &lt;stdlib.h&gt;
       #include &lt;errno.h&gt;
       #include &lt;string.h&gt;
       #include &lt;time.h&gt;
       #include &lt;rpc/auth_des.h&gt;
       #include &lt;netdb.h&gt;

       int use_tcp = 0;
       char *servername = &quot;linux&quot;;

       int
       main(void)
       {
           struct sockaddr_in name;
           struct rpc_timeval time1 = {0,0};
           struct rpc_timeval timeout = {1,0};
           struct hostent *hent;
           int ret;

           memset(&amp;name, 0, sizeof(name));
           sethostent(1);
           hent = gethostbyname(servername);
           memcpy(&amp;name.sin_addr, hent-&gt;h_addr, hent-&gt;h_length);

           ret = rtime(&amp;name, &amp;time1, use_tcp ? NULL : &amp;timeout);
           if (ret &lt; 0)
               perror(&quot;rtime error&quot;);
           else {
            time_t t = time1.tv_sec;
               printf(&quot;%s\n&quot;, ctime(&amp;t));
           }

           exit(EXIT_SUCCESS);
       }

SEE ALSO
       ntpdate(1), inetd(8)

COLOPHON
       This  page  is  part  of  release 3.44 of the Linux man-pages project.  A
       description of the project, and information about reporting bugs, can  be
       found at http://www.kernel.org/doc/man-pages/.



GNU                                2012-08-03                           RTIME(3)

</pre></body></html>
