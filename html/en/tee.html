<html>
<head><meta charset=utf-8/>
<title>tee - duplicating pipe content</title></head>
<body><pre>

TEE(2)                      Linux Programmer&apos;s Manual                     TEE(2)



NAME
       tee - duplicating pipe content

SYNOPSIS
       #define _GNU_SOURCE         /* See feature_test_macros(7) */
       #include &lt;fcntl.h&gt;

       ssize_t tee(int fd_in, int fd_out, size_t len, unsigned int flags);

DESCRIPTION
       tee() duplicates up to len bytes of data from the pipe referred to by the
       file descriptor fd_in to the pipe referred  to  by  the  file  descriptor
       fd_out.   It  does  not  consume  the data that is duplicated from fd_in;
       therefore, that data can be copied by a subsequent splice(2).

       flags is a series of modifier flags, which  share  the  name  space  with
       splice(2) and vmsplice(2):

       SPLICE_F_MOVE      Currently has no effect for tee(); see splice(2).

       SPLICE_F_NONBLOCK  Do  not  block  on  I/O;  see  splice(2)  for  further
                          details.

       SPLICE_F_MORE      Currently has no effect for tee(), but may  be  imple&#8208;
                          mented in the future; see splice(2).

       SPLICE_F_GIFT      Unused for tee(); see vmsplice(2).

RETURN VALUE
       Upon  successful  completion, tee() returns the number of bytes that were
       duplicated between the input and output.  A return value of 0 means  that
       there  was  no  data  to  transfer, and it would not make sense to block,
       because there are no writers connected to  the  write  end  of  the  pipe
       referred to by fd_in.

       On error, tee() returns -1 and errno is set to indicate the error.

ERRORS
       EINVAL fd_in  or  fd_out  does  not  refer to a pipe; or fd_in and fd_out
              refer to the same pipe.

       ENOMEM Out of memory.

VERSIONS
       The tee() system call first appeared in Linux 2.6.17; library support was
       added to glibc in version 2.5.

CONFORMING TO
       This system call is Linux-specific.

NOTES
       Conceptually, tee() copies the data between the two pipes.  In reality no
       real data copying takes place though: under  the  covers,  tee()  assigns
       data in the output by merely grabbing a reference to the input.

EXAMPLE
       The  following  example implements a basic tee(1) program using the tee()
       system call.

       #define _GNU_SOURCE
       #include &lt;fcntl.h&gt;
       #include &lt;stdio.h&gt;
       #include &lt;stdlib.h&gt;
       #include &lt;unistd.h&gt;
       #include &lt;errno.h&gt;
       #include &lt;limits.h&gt;

       int
       main(int argc, char *argv[])
       {
           int fd;
           int len, slen;

           if (argc != 2) {
               fprintf(stderr, &quot;Usage: %s &lt;file&gt;\n&quot;, argv[0]);
               exit(EXIT_FAILURE);
           }

           fd = open(argv[1], O_WRONLY | O_CREAT | O_TRUNC, 0644);
           if (fd == -1) {
               perror(&quot;open&quot;);
               exit(EXIT_FAILURE);
           }

           do {
               /*
                * tee stdin to stdout.
                */
               len = tee(STDIN_FILENO, STDOUT_FILENO,
                         INT_MAX, SPLICE_F_NONBLOCK);

               if (len &lt; 0) {
                   if (errno == EAGAIN)
                       continue;
                   perror(&quot;tee&quot;);
                   exit(EXIT_FAILURE);
               } else
                   if (len == 0)
                       break;

               /*
                * Consume stdin by splicing it to a file.
                */
               while (len &gt; 0) {
                   slen = splice(STDIN_FILENO, NULL, fd, NULL,
                                 len, SPLICE_F_MOVE);
                   if (slen &lt; 0) {
                       perror(&quot;splice&quot;);
                       break;
                   }
                   len -= slen;
               }
           } while (1);

           close(fd);
           exit(EXIT_SUCCESS);
       }

SEE ALSO
       splice(2), vmsplice(2)

COLOPHON
       This page is part of release 3.44 of  the  Linux  man-pages  project.   A
       description  of the project, and information about reporting bugs, can be
       found at http://www.kernel.org/doc/man-pages/.



Linux                              2012-05-04                             TEE(2)

</pre></body></html>
